(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0121"],{"43ca":function(e,t,o){},7577:function(e,t,o){"use strict";var i=o("43ca"),a=o.n(i);a.a},dd4f:function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"table-list-page"},[o("techo-list",{ref:"list",attrs:{title:e.title,header:e.header,data:e.data,isShowCode:e.isShowCode,disCodeOption:e.disCodeOption,recordCount:e.recordCount},on:{onAdd:e.handleAdd,onPageChange:e.handlePageChange,onDelete:e.handleDelete,onView:e.handleView,onEdit:e.handleEdit,onTreeNode:e.handleTreeNode}},[o("div",{attrs:{slot:"header"},slot:"header"},[o("el-row",{staticClass:"techo-list__header-row",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:10}},[o("span",{staticClass:"techo-list__header-col-txt-4"},[e._v("姓名：")]),o("div",{staticClass:"techo-list__header-col-left-4"},[o("el-input",{staticClass:"techo-list__header-select-full",attrs:{placeholder:"请输入姓名",maxlength:10,size:"small",clearable:""},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1)]),o("el-col",{attrs:{span:9}}),o("el-col",{staticClass:"techo-list__header-col-button",attrs:{span:5}},[o("el-button",{staticClass:"techo-list__header-button-reset",attrs:{size:"small"},on:{click:e.handleClear}},[e._v("清空")]),o("el-button",{staticClass:"techo-list__header-button-query",attrs:{size:"small"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1)],1)]),e.dlgVisible?o("techo-details",{ref:"details",attrs:{configKey:e.configKey,height:"60%",title:e.title}}):e._e(),o("vAddDialog",{ref:"vAddDialog",attrs:{disCodeOption:e.disCodeOption}})],1)},a=[],l=o("c93e"),r=o("2e74"),s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{staticClass:"add-dialog",attrs:{title:e.title,visible:e.dialogVisible,fullscreen:"",modal:!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.resetForm}},[o("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"基础信息",name:"first"}},[o("techo-people",{ref:"vBaseForm",attrs:{isAdd:e.isAdd,dic:e.dic},on:{onBasePeople:e.handleQueryBasePeople,onPosition:e.handlePosition}})],1),o("el-tab-pane",{attrs:{label:"位置信息",name:"second"}},[o("vPeoplePosition",{ref:"vPeoplePosition",attrs:{xingzhengqu:e.dic["行政区划"],disCodeOption:e.disCodeOption,isAdd:e.isAdd}})],1),o("el-tab-pane",{attrs:{label:"留守人员",name:"third"}},[o("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.teamRules,"label-width":"180px"}},[o("el-row",{attrs:{gutter:15}},[o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{label:"家庭主要成员姓名",prop:"familyMemberName"}},[o("el-input",{attrs:{maxlength:18,placeholder:"请填写家庭主要成员姓名"},model:{value:e.dialogForm.familyMemberName,callback:function(t){e.$set(e.dialogForm,"familyMemberName",t)},expression:"dialogForm.familyMemberName"}})],1),o("el-form-item",{attrs:{label:"与留守人员关系",prop:"toRearRelation"}},[o("el-select",{attrs:{placeholder:"请选择与留守人员关系",clearable:""},model:{value:e.dialogForm.toRearRelation,callback:function(t){e.$set(e.dialogForm,"toRearRelation",t)},expression:"dialogForm.toRearRelation"}},e._l(e.dic["户主关系"],function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.code}})}))],1),o("el-form-item",{attrs:{label:"家庭主要成员身份证号码",prop:"familyMemberIdCard"}},[o("el-input",{attrs:{maxlength:18,placeholder:"请填写家庭主要成员身份证号码"},model:{value:e.dialogForm.familyMemberIdCard,callback:function(t){e.$set(e.dialogForm,"familyMemberIdCard",t)},expression:"dialogForm.familyMemberIdCard"}})],1)],1),o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{label:"家庭主要成员联系方式",prop:"familyMemberPhone"}},[o("el-input",{attrs:{maxlength:50,placeholder:"请填写家庭主要成员联系方式"},model:{value:e.dialogForm.familyMemberPhone,callback:function(t){e.$set(e.dialogForm,"familyMemberPhone",t)},expression:"dialogForm.familyMemberPhone"}})],1),o("el-form-item",{attrs:{label:"家庭主要成员健康状况"}},[o("el-select",{attrs:{placeholder:"请选择健康状况",clearable:""},model:{value:e.dialogForm.familyMemberHealth,callback:function(t){e.$set(e.dialogForm,"familyMemberHealth",t)},expression:"dialogForm.familyMemberHealth"}},e._l(e.dic["健康状况"],function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.code}})}))],1),o("el-form-item",{attrs:{label:"个人年收入",prop:"peopleIncome"}},[o("el-input",{attrs:{maxlength:8,placeholder:"请填写个人年收入"},model:{value:e.dialogForm.peopleIncome,callback:function(t){e.$set(e.dialogForm,"peopleIncome",t)},expression:"dialogForm.peopleIncome"}})],1)],1),o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{label:"人户一致标识",prop:"householdAgreementSign","label-width":"160px"}},[o("el-select",{attrs:{placeholder:"请选择人户一致标识",clearable:""},model:{value:e.dialogForm.householdAgreementSign,callback:function(t){e.$set(e.dialogForm,"householdAgreementSign",t)},expression:"dialogForm.householdAgreementSign"}},e._l(e.dic["人户一致"],function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.code}})}))],1),o("el-form-item",{attrs:{label:"健康状况","label-width":"160px"}},[o("el-select",{attrs:{placeholder:"请选择健康状况",clearable:""},model:{value:e.dialogForm.healthCondition,callback:function(t){e.$set(e.dialogForm,"healthCondition",t)},expression:"dialogForm.healthCondition"}},e._l(e.dic["健康状况"],function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.code}})}))],1),o("el-form-item",{attrs:{label:"家庭年收入",prop:"familyIncome","label-width":"160px"}},[o("el-input",{attrs:{maxlength:8,placeholder:"请填写家庭年收入"},model:{value:e.dialogForm.familyIncome,callback:function(t){e.$set(e.dialogForm,"familyIncome",t)},expression:"dialogForm.familyIncome"}})],1)],1),o("el-col",{attrs:{span:6}},[o("el-form-item",{attrs:{label:"留守人员类型",prop:"rearPeopleType"}},[o("el-select",{attrs:{placeholder:"请选择留守人员类型",clearable:""},model:{value:e.dialogForm.rearPeopleType,callback:function(t){e.$set(e.dialogForm,"rearPeopleType",t)},expression:"dialogForm.rearPeopleType"}},e._l(e.dic["留守人员类型"],function(e,t){return o("el-option",{key:t,attrs:{label:e.name,value:e.code}})}))],1),o("el-form-item",{attrs:{label:"家庭主要成员工作地详址"}},[o("el-input",{attrs:{maxlength:50,placeholder:"请填写家庭主要成员工作地详址"},model:{value:e.dialogForm.familyMemberJobPlace,callback:function(t){e.$set(e.dialogForm,"familyMemberJobPlace",t)},expression:"dialogForm.familyMemberJobPlace"}})],1)],1)],1),o("el-row",{attrs:{gutter:15}},[o("el-col",{attrs:{span:24}},[o("el-form-item",{attrs:{label:"困难及诉求"}},[o("el-input",{attrs:{type:"textarea",rows:3,maxlength:1024,placeholder:"请填写困难及诉求"},model:{value:e.dialogForm.difficultyDesc,callback:function(t){e.$set(e.dialogForm,"difficultyDesc",t)},expression:"dialogForm.difficultyDesc"}})],1),o("el-form-item",{attrs:{label:"帮扶情况"}},[o("el-input",{attrs:{type:"textarea",rows:3,maxlength:1024,placeholder:"请填写帮扶情况"},model:{value:e.dialogForm.helpInfo,callback:function(t){e.$set(e.dialogForm,"helpInfo",t)},expression:"dialogForm.helpInfo"}})],1)],1)],1)],1)],1)],1),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["first"==e.activeName?o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.activeName="second"}}},[e._v("下一步")]):e._e(),"second"==e.activeName?o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.activeName="first"}}},[e._v("上一步")]):e._e(),"second"==e.activeName?o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.activeName="third"}}},[e._v("下一步")]):e._e(),"third"==e.activeName?o("el-button",{attrs:{type:"warning",size:"small"},on:{click:e.resetForm}},[e._v("取消")]):e._e(),"third"==e.activeName?o("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.activeName="second"}}},[e._v("上一步")]):e._e(),"third"==e.activeName?o("el-button",{attrs:{type:"success",size:"small"},on:{click:e.submitForm}},[e._v("保存")]):e._e()],1)],1)},n=[],d=(o("7f7f"),o("ac6a"),o("3fe9")),c={props:{disCodeOption:{type:Array,default:[]}},components:{vPeoplePosition:d["a"]},data:function(){return{dialogVisible:!1,isAdd:!0,title:"",activeName:"first",dic:{"性别":[],"民族":[],"婚姻状况":[],"政治面貌":[],"学历":[],"宗教信仰":[],"职业类别":[],"健康状况":[],"人户一致":[],"留守人员类型":[],"户主关系":[],"行政区划":[]},dialogForm:{familyMemberHealth:"01",healthCondition:"01"},teamRules:{householdAgreementSign:[{required:!0,message:"请选择人户一致标识",trigger:"change"}],rearPeopleType:[{required:!0,message:"请选择留守人员类型",trigger:"change"}],familyMemberName:[{required:!0,message:"请输入家庭主要成员姓名",trigger:"blur"},{min:2,max:12,message:"长度在 2 到 10 个字符",trigger:"blur"}],toRearRelation:[{required:!0,message:"请选择与留守人员关系",trigger:"change"}],familyMemberPhone:[{required:!0,message:"请输入家庭主要成员联系方式",trigger:"blur"},util.validate.tellAndPhone()],familyMemberIdCard:[util.validate.isIDCard()],peopleIncome:[util.validate.valiInteger()],familyIncome:[util.validate.valiInteger()]},houseInfo:{}}},created:function(){var e=this;r["a"].requestDicCatalog(function(t){var o=_.keys(e.dic);_.map(t,function(t){-1!=_.indexOf(o,t.name)&&r["a"].requestDicType(t.id,function(o){"职业类别"==t.name?e.dic[t.name]=e.handleTreeData(o):e.dic[t.name]=o})})})},watch:{activeName:function(e){var t=this;"second"==e?(this.$refs["vBaseForm"].baseForm.id&&r["a"].requestBaseIdByPeople("people/rear/findPage",this.$refs["vBaseForm"].baseForm.id,function(e){0!=e.totalCount&&(t.isAdd=!1,t.dialogForm=e.list[0])}),this.$refs["vBaseForm"].$refs["baseForm"].validate(function(e){e||t.$nextTick(function(){t.activeName="first"})}),this.$refs["vPeoplePosition"].$refs["houseItem"]&&this.$refs["vPeoplePosition"].$refs["houseItem"].initGridData(),this.$refs["vPeoplePosition"].$refs["liveHouseItem"]&&this.$refs["vPeoplePosition"].$refs["liveHouseItem"].initGridData()):"third"==e&&new Promise(function(e,o){1==t.$refs["vPeoplePosition"].showHujiForm?(t.$refs["vPeoplePosition"].$refs["houseItem"].$refs["houseItem"].validate(function(e){e||t.$nextTick(function(){t.activeName="second"})}),t.houseInfo=t.$refs["vPeoplePosition"].$refs["houseItem"].houseInfo,e()):r["a"].requestHouseInfo(t.$refs["vBaseForm"].baseForm.houseId,function(o){t.houseInfo=o,e()}),1==t.$refs["vPeoplePosition"].showXianzhuForm&&t.$refs["vPeoplePosition"].$refs["liveHouseItem"].$refs["liveHouseItem"].validate(function(e){e||t.$nextTick(function(){t.activeName="second"})})}).then(function(){t.dialogForm=Object(l["a"])({},t.dialogForm,{districtCode:t.houseInfo.districtCode})})}},methods:{handleTreeData:function(e){var t=_.map(_.filter(e,function(e){return"0000"===e.code.slice(1,5)}),function(e){return{code:e.code,label:e.name,children:[]}});return _.map(t,function(t){t.children=_.map(_.filter(e,function(e){return e.code.slice(0,1)===t.code.slice(0,1)&&"0000"!==e.code.slice(1,5)&&"00"===e.code.slice(3,5)}),function(e){return{code:e.code,label:e.name,children:[]}})}),_.map(t,function(t){_.map(t.children,function(t){t.children=_.map(_.filter(e,function(e){return e.code.slice(0,3)===t.code.slice(0,3)&&"00"!==e.code.slice(3,5)}),function(e){return{code:e.code,label:e.name}})})}),t},handlePosition:function(e){this.$refs["vPeoplePosition"].hujidi=e.domicilePlaceDetail,this.$refs["vPeoplePosition"].xianzhudi=e.livePlaceDetail,this.$refs["vPeoplePosition"].showHujiForm=!1,this.$refs["vPeoplePosition"].showXianzhuForm=!1},handleQueryBasePeople:function(e,t){r["a"].requestBasePeopleList(e,function(e){t&&t(e.list)})},submitForm:function(){var e=this,t=_.cloneDeep(this.$refs["vBaseForm"].baseForm);if(t.birthDate=t.birthDate&&util.time.formatDate(t.birthDate,"YYYY-MM-DD"),t.occupationType=_.last(t.occupationType),t.districtCode=this.houseInfo.districtCode,1==this.$refs["vPeoplePosition"].showHujiForm){var o=this.$refs["vPeoplePosition"].$refs["houseItem"].positionForm;t.domicilePlace=o.province,t.domicilePlaceDetail=o.domicilePlaceDetail,t.houseId=o.houseId}if(1==this.$refs["vPeoplePosition"].showXianzhuForm){var i=this.$refs["vPeoplePosition"].$refs["liveHouseItem"].positionForm;t.livePlace=i.province,t.livePlaceDetail=i.domicilePlaceDetail,t.liveHouseId=i.houseId||""}t.dicMap&&delete t.dicMap,this.$refs["dialogForm"].validate(function(o){if(!o)return console.log("error submit!!"),!1;t.id?r["a"].requestUpdatePeopleInfo(t,function(t){e.comminForm(t)}):r["a"].requestSavePeopleInfo(t,function(t){e.comminForm(t)})})},comminForm:function(e){var t=this,o=_.cloneDeep(this.dialogForm);if(o.dicMap&&delete o.dicMap,1==this.isAdd)o.peopleId=e.id,r["a"].requestSaveRearPeople(o,function(e){t.$popup.showNotification({type:"success",message:"留守人员添加成功！"}),t.resetForm(),t.$parent.handleQuery()});else{var i=_.pick(o,["difficultyDesc","districtCode","familyIncome","familyMemberHealth","familyMemberIdCard","familyMemberJobPlace","familyMemberName","familyMemberPhone","healthCondition","helpInfo","householdAgreementSign","id","peopleId","peopleIncome","rearPeopleType","toRearRelation"]);r["a"].requestUpdateRearPeople(i,function(e){t.$popup.showNotification({type:"success",message:"留守人员修改成功！"}),t.resetForm(),t.$parent.handleQuery()})}},resetForm:function(){this.$refs["vBaseForm"].$refs["baseForm"].resetFields(),this.$refs["vBaseForm"].resetBaseForm(),this.$refs["dialogForm"].resetFields(),this.$refs["vPeoplePosition"].destroyedForm(),this.dialogForm={familyMemberHealth:"01",healthCondition:"01"},this.houseInfo={},this.$data.dialogVisible=!1,this.activeName="first",this.isAdd=!0}}},m=c,u=(o("7577"),o("2877")),p=Object(u["a"])(m,s,n,!1,null,null,null);p.options.__file="rear-people-add.vue";var f=p.exports,h={components:{vAddDialog:f},data:function(){return{title:"留守人员",queryForm:{districtCode:"",name:""},header:{"姓名":"name","健康状况":"dicMap.healthCondition","个人年收入":"peopleIncome","留守人员类型":"dicMap.rearPeopleType","家庭主要成员姓名":"familyMemberName","与留守人员关系":"dicMap.toRearRelation","家庭主要成员联系方式":"familyMemberPhone"},data:[],recordCount:0,disCodeOption:[],isShowCode:["6102"],dlgVisible:!1,configKey:"rearPeople"}},mounted:function(){var e=this;r["a"].requestGridCode(function(t){e.disCodeOption=[t],e.isShowCode=[t.code],e.queryForm.districtCode=t.code})},watch:{queryForm:{handler:function(e,t){this.handleQuery()},deep:!0}},methods:{handleTreeNode:function(e){this.queryForm.districtCode=e.code},handleAdd:function(){this.$refs["vAddDialog"].dialogVisible=!0,this.$refs["vAddDialog"].isAdd=!0,this.$refs["vAddDialog"].title="添加"+this.title},handleDelete:function(e){var t=this;this.$popup.showLoading("正在删除中，请稍候..."),new Promise(function(t,o){var i=0;_.map(e,function(o,a){r["a"].requestDeleteRearPeople(o.id,function(o){i++,i==e.length&&t()})})}).then(function(){t.$popup.showNotification({type:"success",message:"留守人员删除成功！"}),t.handleQuery(),t.$popup.closeLoading()}).catch(function(){t.$popup.showNotification({type:"warning",message:"留守人员删除失败！"}),t.$popup.closeLoading()})},handlePageChange:function(){this.data=[],this.handleQuery()},handleView:function(e,t){this.dlgVisible=!0,this.$nextTick(function(){this.$refs["details"].data=t,this.$refs["details"].visible=!0})},handleEdit:function(e,t){var o=this;this.$refs["vAddDialog"].dialogVisible=!0,this.$refs["vAddDialog"].isAdd=!1,this.$refs["vAddDialog"].title="修改"+this.title,r["a"].requestBasePeople(t.peopleId,function(e){if(null!=e.occupationType&&""!=e.occupationType){var t=[e.occupationType.substr(0,1)+"0000",e.occupationType.substr(0,3)+"00",e.occupationType];e.occupationType=_.uniq(t)}else e.occupationType=[];o.$refs["vAddDialog"].$refs["vBaseForm"].baseForm=e,o.$refs["vAddDialog"].handlePosition(e)}),this.$refs["vAddDialog"].dialogForm=_.cloneDeep(t)},handleClear:function(){this.queryForm={districtCode:constants.REGION.CODE,name:""}},handleQuery:function(){var e=this,t=this.$refs["list"].getPageInfo();t=Object(l["a"])({},t,_.cloneDeep(this.queryForm)),r["a"].requestPageRearPeople(t,function(o){0!=o.totalCount&&0==o.list.length?(t.page=o.totalPage,r["a"].requestPageRearPeople(t,function(t){e.recordCount=t.totalCount,e.data=t.list})):(e.recordCount=o.totalCount,e.data=o.list)})}}},g=h,v=Object(u["a"])(g,i,a,!1,null,null,null);v.options.__file="rear-people-list.vue";t["default"]=v.exports}}]);
//# sourceMappingURL=chunk-0121.939f608b.js.map